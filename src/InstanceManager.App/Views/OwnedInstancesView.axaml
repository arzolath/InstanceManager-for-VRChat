<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:InstanceManager.App.ViewModels"
             xmlns:logs="clr-namespace:InstanceManager.Storage.Logs;assembly=InstanceManager.Storage"
             x:Class="InstanceManager.App.Views.OwnedInstancesView"
             x:DataType="vm:OwnedInstancesViewModel">

  <Border Classes="card" Padding="20">
    <Grid RowDefinitions="Auto,Auto,*" RowSpacing="14">

      <!-- Header -->
      <Grid Grid.Row="0" ColumnDefinitions="Auto,*" ColumnSpacing="10" VerticalAlignment="Center">
        <Button Grid.Column="0"
                Command="{Binding RefreshAsync}"
                IsEnabled="{Binding CanInteract}"
                ToolTip.Tip="Refresh"
                Width="42" Height="42" Padding="0" VerticalAlignment="Center">
          <TextBlock Text="&#xE72C;"
                     FontFamily="Segoe MDL2 Assets"
                     FontSize="16"
                     FontWeight="SemiBold"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"/>
        </Button>

        <StackPanel Grid.Column="1" Spacing="4">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="Owned Instances" Classes="heading"/>
            <Border Background="#1422D3EE"
                    BorderBrush="#2222D3EE"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="8,4">
              <TextBlock Text="VRChat API" Foreground="{StaticResource Color.AccentAlt}" FontSize="{StaticResource Font.Size.Small}"/>
            </Border>
          </StackPanel>
          <TextBlock Text="{Binding Status}"
                     Classes="muted"
                     TextWrapping="Wrap"/>
        </StackPanel>
      </Grid>

      <ProgressBar Grid.Row="1" IsIndeterminate="True" IsVisible="{Binding IsBusy}" />

      <!-- Content -->
      <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="0,0,16,0">
        <StackPanel Spacing="16" Margin="0,0,8,0">

          <Border Classes="card" Padding="14">
            <StackPanel Spacing="10">
              <TextBlock Text="Instances you own" FontWeight="SemiBold" />

              <ItemsControl ItemsSource="{Binding Instances}" HorizontalAlignment="Stretch">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Spacing="10"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="vm:OwnedInstanceItem">
                    <Border Background="{StaticResource Color.SurfaceAlt}"
                            BorderBrush="{StaticResource Color.SubtleBorder}"
                            BorderThickness="1"
                            CornerRadius="10"
                            Padding="12">
                      <StackPanel Spacing="8">
                        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
                          <StackPanel Spacing="2">
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Location}" Classes="muted" FontSize="{StaticResource Font.Size.Small}"/>
                          </StackPanel>
                          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                            <Border Background="#143BB273" Padding="8,4" CornerRadius="8">
                              <TextBlock Text="{Binding UserCount, StringFormat='Users: {0}'}" Foreground="{StaticResource Color.Success}" />
                            </Border>
                            <Border Background="#14F59E0B" Padding="8,4" CornerRadius="8">
                              <TextBlock Text="{Binding Capacity, StringFormat='Capacity: {0}'}" Foreground="{StaticResource Color.Warning}" />
                            </Border>
                          </StackPanel>
                        </Grid>

                        <ItemsControl ItemsSource="{Binding Users}">
                          <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                              <WrapPanel />
                            </ItemsPanelTemplate>
                          </ItemsControl.ItemsPanel>
                          <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:InstanceUser">
                              <Border Background="#14252A38" Padding="6,4" CornerRadius="6" BorderBrush="{StaticResource Color.SubtleBorder}" BorderThickness="1" Margin="0,0,6,6">
                                <TextBlock Text="{Binding Label}" />
                              </Border>
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </StackPanel>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

            </StackPanel>
          </Border>

          <Border Classes="card" Padding="14">
            <StackPanel Spacing="10">
              <TextBlock Text="Kick history" FontWeight="SemiBold" />

              <ItemsControl ItemsSource="{Binding KickEvents}" HorizontalAlignment="Stretch">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Spacing="8"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="logs:KickLogEntry">
                    <Border Background="{StaticResource Color.SurfaceAlt}"
                            BorderBrush="{StaticResource Color.SubtleBorder}"
                            BorderThickness="1"
                            CornerRadius="10"
                            Padding="12">
                      <StackPanel Spacing="4">
                        <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:u}'}" FontSize="{StaticResource Font.Size.Small}" Classes="muted" />
                        <TextBlock Text="{Binding PlayerLabel}" FontWeight="SemiBold" />
                        <TextBlock Text="{Binding InstanceLabel}" Classes="muted" />
                        <TextBlock Text="{Binding Action}" FontSize="{StaticResource Font.Size.Small}" />
                        <TextBlock Text="{Binding Details}" FontSize="{StaticResource Font.Size.Small}" Classes="muted" />
                      </StackPanel>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>

    </Grid>
  </Border>
</UserControl>
